<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/home-layout :: head(${subscription.houseName + ' ì²­ì•½ ë¶„ì„'}, ${pageDescription})}"></head>
<head>
    <style>
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .hero {
            padding: 56px 0 0;
        }

        .hero-back {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 32px;
            transition: color 0.15s;
        }
        .hero-back:hover { color: var(--primary); }

        .hero-status {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 16px;
        }
        .hero-status.active { background: #dcfce7; color: #16a34a; }
        .hero-status.upcoming { background: #dbeafe; color: #2563eb; }
        .hero-status.closed { background: var(--bg); color: var(--text-muted); }

        .hero h1 {
            font-size: 36px;
            font-weight: 900;
            letter-spacing: -1.5px;
            line-height: 1.25;
            color: var(--text);
            margin-bottom: 12px;
            word-break: keep-all;
        }

        .hero-sub {
            font-size: 16px;
            color: var(--text);
            font-weight: 600;
            margin-bottom: 0;
        }

        .hero-sub span {
            margin: 0 6px;
            color: var(--text-muted);
        }


        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ SEO Description â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .seo-desc {
            padding: 20px 0 0;
            font-size: 15.5px;
            line-height: 1.9;
            color: var(--text-secondary);
            word-break: keep-all;
        }

        .seo-desc strong {
            color: var(--text);
            font-weight: 700;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Insight Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .insight-banner {
            margin-top: 32px;
            border-radius: 20px;
            padding: 28px 32px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .insight-banner.positive { background: #f0fdf4; }
        .insight-banner.negative { background: #fef2f2; }

        .insight-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 24px;
        }

        .insight-banner.positive .insight-icon { background: #dcfce7; }
        .insight-banner.negative .insight-icon { background: #fee2e2; }

        .insight-text {
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-secondary);
            word-break: keep-all;
        }

        .insight-text strong {
            font-weight: 800;
        }

        .insight-banner.positive .insight-text strong { color: #16a34a; }
        .insight-banner.negative .insight-text strong { color: #ef4444; }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Section â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .section {
            padding-top: 56px;
        }

        .section-title {
            font-size: 22px;
            font-weight: 800;
            letter-spacing: -0.5px;
            color: var(--text);
            margin-bottom: 24px;
        }

        .section-title .muted {
            font-weight: 500;
            color: var(--text-muted);
            font-size: 16px;
            margin-left: 8px;
        }

        .sub-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: 16px;
            margin-top: 32px;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Info Grid (ê¸°ë³¸ì •ë³´ + ì¼ì •) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .info-card {
            background: var(--card);
            border-radius: 20px;
            padding: 28px;
        }

        .info-card-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
        }

        .info-item + .info-item {
            border-top: 1px solid var(--bg);
        }

        .info-item-label {
            font-size: 14px;
            color: var(--text-muted);
        }

        .info-item-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .info-item-value a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }
        .info-item-value a:hover { text-decoration: underline; }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Map â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .map-section {
            margin-top: 16px;
        }

        .map-wrap {
            background: var(--card);
            border-radius: 20px;
            overflow: hidden;
        }

        #kakaoMap {
            width: 100%;
            height: 280px;
        }

        .map-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 280px;
            background: var(--card);
            color: var(--text-muted);
            font-size: 14px;
        }

        .map-address {
            padding: 16px 24px;
            font-size: 13px;
            color: var(--text-muted);
            background: var(--card);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Table Card â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .table-card {
            background: var(--card);
            border-radius: 20px;
            padding: 28px;
        }

        .tbl {
            width: 100%;
            border-collapse: collapse;
        }

        .tbl th {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            padding: 0 12px 16px;
            text-align: right;
            border-bottom: 2px solid var(--bg);
        }

        .tbl th:first-child { text-align: left; }

        .tbl td {
            font-size: 14px;
            padding: 16px 12px;
            text-align: right;
            border-bottom: 1px solid var(--bg);
            color: var(--text);
        }

        .tbl td:first-child {
            text-align: left;
            font-weight: 600;
        }

        .tbl tbody tr:last-child td { border-bottom: none; }

        .tbl .accent { color: var(--primary); font-weight: 700; }
        .tbl .green { color: #16a34a; font-weight: 700; }
        .tbl .red { color: #ef4444; font-weight: 700; }
        .tbl .yellow { color: #ca8a04; font-weight: 700; }

        .tbl .type-sub {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 400;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Comparison Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .comparison-hero {
            background: var(--card);
            border-radius: 20px;
            padding: 36px;
            text-align: center;
            margin-bottom: 16px;
        }

        .comparison-hero-value {
            font-size: 40px;
            font-weight: 900;
            letter-spacing: -1px;
            margin-bottom: 6px;
        }

        .comparison-hero-value.green { color: #16a34a; }
        .comparison-hero-value.red { color: #ef4444; }
        .comparison-hero-value.yellow { color: #ca8a04; }

        .comparison-hero-label {
            font-size: 14px;
            color: var(--text-muted);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Stat Row â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .stat-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: var(--card);
            border-radius: 20px;
            padding: 28px 20px;
            text-align: center;
        }

        .stat-card-value {
            font-size: 26px;
            font-weight: 800;
            color: var(--primary);
            letter-spacing: -0.5px;
            margin-bottom: 6px;
        }

        .stat-card-label {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Transaction List â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .tx-list {
            max-height: 480px;
            overflow-y: auto;
        }

        .tx-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
        }

        .tx-item + .tx-item {
            border-top: 1px solid var(--bg);
        }

        .tx-name {
            font-size: 15px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }

        .tx-meta {
            font-size: 13px;
            color: var(--text-muted);
        }

        .tx-price {
            font-size: 18px;
            font-weight: 800;
            color: var(--primary);
            letter-spacing: -0.3px;
            white-space: nowrap;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Note Box â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .note-box {
            background: var(--bg);
            border-radius: 16px;
            padding: 20px 24px;
            margin-top: 20px;
            font-size: 13px;
            color: var(--text-muted);
            line-height: 1.8;
        }

        .note-box ul {
            margin: 0;
            padding-left: 18px;
        }

        .note-box li + li { margin-top: 4px; }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Empty â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .empty {
            text-align: center;
            padding: 48px 20px;
            color: var(--text-muted);
            font-size: 14px;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Market Note (SEO) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .market-note-seo {
            font-size: 14px;
            color: var(--text-muted);
            line-height: 1.8;
            word-break: keep-all;
            margin-top: 16px;
        }

        .market-note-seo .num {
            color: var(--primary);
            font-weight: 700;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Bottom Spacer â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .bottom-spacer {
            height: 80px;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 768px) {
            .hero { padding: 40px 0 36px; }
            .hero h1 { font-size: 28px; letter-spacing: -1px; }
            .hero-sub { font-size: 14px; }

            .info-grid { grid-template-columns: 1fr; }
            .stat-row { grid-template-columns: 1fr; gap: 8px; }
            .stat-card { display: flex; justify-content: space-between; align-items: center; padding: 18px 20px; text-align: left; }
            .stat-card-value { font-size: 22px; margin-bottom: 0; }

            .section { padding-top: 40px; }
            .section-title { font-size: 20px; }

            .comparison-hero { padding: 28px; }
            .comparison-hero-value { font-size: 32px; }

            .table-card { padding: 20px 16px; }
            .tbl th, .tbl td { padding: 12px 8px; font-size: 13px; }

            .insight-banner { flex-direction: column; align-items: flex-start; padding: 24px; }

            .tbl-scroll { overflow-x: auto; }
        }
    </style>
</head>
<body>
    <nav th:replace="~{fragments/home-layout :: navbar}"></nav>

    <div class="container">
        <!-- ========== HERO ========== -->
        <div class="hero">
            <a href="/home" class="hero-back">&larr; ëª©ë¡ìœ¼ë¡œ</a>

            <div>
                <span class="hero-status"
                      th:classappend="${statusLabel == 'ì ‘ìˆ˜ì¤‘'} ? 'active' : (${statusLabel == 'ì ‘ìˆ˜ì˜ˆì •'} ? 'upcoming' : 'closed')"
                      th:text="${statusLabel}">ì ‘ìˆ˜ì¤‘</span>
            </div>

            <h1 th:text="${subscription.houseName}">ì²­ì•½ ì•„íŒŒíŠ¸ëª…</h1>

            <p class="hero-sub">
                <span th:text="${subscription.area}" style="margin:0">ì„œìš¸</span>
                <span th:if="${subscription.houseType}">Â·</span>
                <span th:if="${subscription.houseType}" th:text="${subscription.houseType}" style="margin:0">APT</span>
                <span th:if="${subscription.totalSupplyCount}">Â·</span>
                <span th:if="${subscription.totalSupplyCount}" th:text="${#numbers.formatInteger(subscription.totalSupplyCount, 0, 'COMMA')} + 'ì„¸ëŒ€'" style="margin:0">100ì„¸ëŒ€</span>
            </p>

        </div>

        <!-- ========== SEO DESCRIPTION ========== -->
        <p class="seo-desc">
            <span th:text="${subscription.area}">ì„œìš¸</span>ì— ìœ„ì¹˜í•œ
            <strong th:text="${subscription.houseName}">ì•„íŒŒíŠ¸ëª…</strong>ì€(ëŠ”)
            <th:block th:if="${subscription.houseType}"><span th:text="${subscription.houseType}">APT</span>ìœ¼ë¡œ, </th:block>
            <th:block th:if="${subscription.totalSupplyCount}">ì´ <strong th:text="${#numbers.formatInteger(subscription.totalSupplyCount, 0, 'COMMA')}">100</strong>ì„¸ëŒ€ë¥¼ ê³µê¸‰í•´ìš”. </th:block>
            ì ‘ìˆ˜ ê¸°ê°„ì€
            <strong th:text="${#temporals.format(subscription.receiptStartDate, 'yyyyë…„ Mì›” dì¼')}">2025ë…„ 1ì›” 1ì¼</strong>ë¶€í„°
            <th:block th:if="${subscription.receiptEndDate}">
                <strong th:text="${#temporals.format(subscription.receiptEndDate, 'yyyyë…„ Mì›” dì¼')}">2025ë…„ 1ì›” 5ì¼</strong>ê¹Œì§€ì˜ˆìš”.
            </th:block>
            <th:block th:if="${subscription.winnerAnnounceDate}">
                ë‹¹ì²¨ì ë°œí‘œì¼ì€ <strong th:text="${#temporals.format(subscription.winnerAnnounceDate, 'yyyyë…„ Mì›” dì¼')}">2025ë…„ 1ì›” 15ì¼</strong>ì´ì—ìš”.
            </th:block>
        </p>

        <!-- ========== INSIGHT BANNER ========== -->
        <th:block th:if="${houseTypeComparisons != null and !houseTypeComparisons.isEmpty() and houseTypeComparisons[0].estimatedProfit != null}">
            <div th:with="c=${houseTypeComparisons[0]}"
                 class="insight-banner"
                 th:classappend="${c.estimatedProfit > 0} ? 'positive' : 'negative'">
                <div class="insight-icon">
                    <span th:if="${c.estimatedProfit > 0}">ğŸ“ˆ</span>
                    <span th:if="${c.estimatedProfit <= 0}">ğŸ“‰</span>
                </div>
                <div class="insight-text">
                    <th:block th:if="${c.estimatedProfit > 0}">
                        <span th:text="${c.houseType}">59A</span> ê¸°ì¤€ ë¶„ì–‘ê°€
                        <strong th:text="${c.supplyPriceFormatted}">5ì–µ</strong>ì€
                        ì£¼ë³€ ì‹œì„¸(<strong th:text="${c.marketPriceFormatted}">7ì–µ</strong>) ëŒ€ë¹„
                        ì•½ <strong th:text="${c.estimatedProfitFormatted.substring(1)}">2ì–µ</strong> ì €ë ´í•œ ìˆ˜ì¤€ì´ì—ìš”.
                    </th:block>
                    <th:block th:if="${c.estimatedProfit <= 0}">
                        <span th:text="${c.houseType}">59A</span> ê¸°ì¤€ ë¶„ì–‘ê°€
                        <strong th:text="${c.supplyPriceFormatted}">5ì–µ</strong>ì€
                        ì£¼ë³€ ì‹œì„¸(<strong th:text="${c.marketPriceFormatted}">7ì–µ</strong>) ëŒ€ë¹„
                        ì•½ <strong th:text="${c.estimatedProfitFormatted.substring(1)}">1ì–µ</strong> ë†’ì€ ìˆ˜ì¤€ì´ì—ìš”.
                    </th:block>
                </div>
            </div>
        </th:block>

        <!-- ========== ê¸°ë³¸ ì •ë³´ + ì¼ì • ========== -->
        <div class="section">
            <h2 class="section-title">ì²­ì•½ ì •ë³´</h2>
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-card-title">ê¸°ë³¸ ì •ë³´</div>
                    <div class="info-item">
                        <span class="info-item-label">ì£¼íƒëª…</span>
                        <span class="info-item-value" th:text="${subscription.houseName}">-</span>
                    </div>
                    <div class="info-item" th:if="${subscription.houseType}">
                        <span class="info-item-label">ì£¼íƒìœ í˜•</span>
                        <span class="info-item-value" th:text="${subscription.houseType}">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">ì§€ì—­</span>
                        <span class="info-item-value" th:text="${subscription.area}">-</span>
                    </div>
                    <div class="info-item" th:if="${subscription.address}">
                        <span class="info-item-label">ì£¼ì†Œ</span>
                        <span class="info-item-value" th:text="${subscription.address}">-</span>
                    </div>
                    <div class="info-item" th:if="${subscription.totalSupplyCount}">
                        <span class="info-item-label">ê³µê¸‰ì„¸ëŒ€</span>
                        <span class="info-item-value" th:text="${#numbers.formatInteger(subscription.totalSupplyCount, 0, 'COMMA')} + 'ì„¸ëŒ€'">-</span>
                    </div>
                </div>

                <div class="info-card">
                    <div class="info-card-title">ì¼ì •</div>
                    <div class="info-item" th:if="${subscription.announceDate}">
                        <span class="info-item-label">ê³µê³ ì¼</span>
                        <span class="info-item-value" th:text="${#temporals.format(subscription.announceDate, 'yyyy.MM.dd')}">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">ì ‘ìˆ˜ê¸°ê°„</span>
                        <span class="info-item-value">
                            <span th:text="${#temporals.format(subscription.receiptStartDate, 'yyyy.MM.dd')}">-</span>
                            <span th:if="${subscription.receiptEndDate}">
                                ~ <span th:text="${#temporals.format(subscription.receiptEndDate, 'MM.dd')}">-</span>
                            </span>
                        </span>
                    </div>
                    <div class="info-item" th:if="${subscription.winnerAnnounceDate}">
                        <span class="info-item-label">ë‹¹ì²¨ì ë°œí‘œ</span>
                        <span class="info-item-value" th:text="${#temporals.format(subscription.winnerAnnounceDate, 'yyyy.MM.dd')}">-</span>
                    </div>
                    <div class="info-item" th:if="${subscription.detailUrl}">
                        <span class="info-item-label">ìƒì„¸ì •ë³´</span>
                        <span class="info-item-value">
                            <a th:href="${subscription.detailUrl}" target="_blank">ë°”ë¡œê°€ê¸° â†’</a>
                        </span>
                    </div>
                </div>
            </div>

            <!-- ìœ„ì¹˜ -->
            <div th:if="${subscription.address != null and subscription.address != ''}" style="margin-top: 32px;">
                <h3 class="sub-title">ìœ„ì¹˜</h3>
                <div class="map-wrap">
                    <div class="map-loading" id="mapLoading">
                        <span>ì§€ë„ ë¡œë”© ì¤‘...</span>
                    </div>
                    <div id="kakaoMap" style="display:none;"></div>
                    <p class="map-address" th:text="${subscription.address}">ì£¼ì†Œ</p>
                </div>
            </div>

            <!-- ë¶„ì–‘ê°€ -->
            <div style="margin-top: 32px;">
                <h3 class="sub-title">ë¶„ì–‘ê°€</h3>
                <div class="table-card" th:if="${prices != null and !prices.isEmpty()}">
                    <div class="tbl-scroll">
                        <table class="tbl">
                            <thead>
                                <tr>
                                    <th>ì£¼íƒí˜•</th>
                                    <th>ê³µê¸‰ë©´ì </th>
                                    <th>ì„¸ëŒ€ìˆ˜</th>
                                    <th>ë¶„ì–‘ê°€</th>
                                    <th>í‰ë‹¹ê°€</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="p : ${prices}">
                                    <td th:text="${p.houseType} ?: '-'">59A</td>
                                    <td th:text="${p.supplyArea != null} ? ${#numbers.formatDecimal(p.supplyArea, 1, 2)} + 'ã¡' : '-'">84.12ã¡</td>
                                    <td th:text="${(p.supplyCount ?: 0) + (p.specialSupplyCount ?: 0) > 0} ? ${(p.supplyCount ?: 0) + (p.specialSupplyCount ?: 0)} + 'ì„¸ëŒ€' : '-'">100ì„¸ëŒ€</td>
                                    <td class="accent">
                                        <span th:if="${p.topAmount != null and p.topAmount >= 10000}"
                                              th:text="${#numbers.formatDecimal(p.topAmount / 10000.0, 1, 1)} + 'ì–µ'">5.2ì–µ</span>
                                        <span th:if="${p.topAmount != null and p.topAmount < 10000}"
                                              th:text="${#numbers.formatInteger(p.topAmount, 0, 'COMMA')} + 'ë§Œ'">5,000ë§Œ</span>
                                        <span th:if="${p.topAmount == null}">-</span>
                                    </td>
                                    <td>
                                        <span th:if="${p.pricePerPyeong != null}"
                                              th:text="${#numbers.formatInteger(p.pricePerPyeong, 0, 'COMMA')} + 'ë§Œ/í‰'">2,100ë§Œ/í‰</span>
                                        <span th:if="${p.pricePerPyeong == null}">-</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="table-card" th:if="${prices == null or prices.isEmpty()}">
                    <div class="empty">ë¶„ì–‘ê°€ ì •ë³´ê°€ ì•„ì§ ì—†ì–´ìš”.</div>
                </div>
            </div>
        </div>

        <!-- ========== ì‹œì„¸ ëŒ€ë¹„ ë¶„ì„ ========== -->
        <div class="section" th:if="${houseTypeComparisons != null and !houseTypeComparisons.isEmpty()}">
            <h2 class="section-title">ì‹œì„¸ ëŒ€ë¹„ ë¶„ì„<span class="muted" th:if="${dongName}" th:text="${dongName}">ì—­ì‚¼ë™</span></h2>

            <!-- ëŒ€í‘œ ì°¨ìµ -->
            <th:block th:if="${houseTypeComparisons[0].estimatedProfit != null}">
                <div class="comparison-hero" th:with="c=${houseTypeComparisons[0]}">
                    <div class="comparison-hero-value"
                         th:classappend="${c.estimatedProfit >= 10000} ? 'green' : (${c.estimatedProfit > 0} ? 'yellow' : 'red')"
                         th:text="${c.estimatedProfitFormatted}">+2ì–µ</div>
                    <div class="comparison-hero-label">
                        <span th:text="${c.houseType}">59A</span> ê¸°ì¤€ ì˜ˆìƒ ì°¨ìµ
                    </div>
                </div>
            </th:block>

            <!-- í‰í˜•ë³„ ë¹„êµ -->
            <div class="table-card">
                <div class="tbl-scroll">
                    <table class="tbl">
                        <thead>
                            <tr>
                                <th>í‰í˜•</th>
                                <th>ë¶„ì–‘ê°€</th>
                                <th>ì£¼ë³€ì‹œì„¸</th>
                                <th>ì˜ˆìƒì°¨ìµ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="c : ${houseTypeComparisons}">
                                <td>
                                    <div th:text="${c.houseType}">59A</div>
                                    <div class="type-sub" th:text="${c.supplyArea != null ? #numbers.formatDecimal(c.supplyArea, 1, 0) + 'ã¡' : ''}">84ã¡</div>
                                </td>
                                <td th:text="${c.supplyPriceFormatted}">5.5ì–µ</td>
                                <td class="accent" th:text="${c.marketPriceFormatted}">7.2ì–µ</td>
                                <td th:classappend="${c.estimatedProfit != null and c.estimatedProfit >= 10000} ? 'green' : (${c.estimatedProfit != null and c.estimatedProfit > 0} ? 'yellow' : 'red')"
                                    th:text="${c.estimatedProfitFormatted}">+1.7ì–µ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="note-box">
                    <ul>
                        <li>ë™ì¼ ë™ ë‚´ ìœ ì‚¬ ë©´ì (Â±10ã¡) ìµœê·¼ ì‹¤ê±°ë˜ê°€ ê¸°ì¤€</li>
                        <li><strong>ì‹ ì¶• í”„ë¦¬ë¯¸ì—„ ë¯¸ë°˜ì˜</strong> â€” ì‹¤ì œ ì‹ ì¶• ì‹œì„¸ëŠ” ë” ë†’ì„ ìˆ˜ ìˆì–´ìš”</li>
                        <li>ì‹¤ê±°ë˜ê°€ ë°ì´í„°ê°€ ë¶€ì¡±í•œ ê²½ìš° ê°€ì¥ ìœ ì‚¬í•œ ë©´ì  ê±°ë˜ë¥¼ ì°¸ê³ í–ˆì–´ìš”</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ========== ì£¼ë³€ ì‹œì„¸ ========== -->
        <div class="section">
            <h2 class="section-title">ì£¼ë³€ ì‹œì„¸<span class="muted">ìµœê·¼ 3ê°œì›”</span></h2>

            <div th:if="${marketAnalysis != null}">
                <div class="stat-row">
                    <div class="stat-card">
                        <div class="stat-card-label">í‰ê·  í‰ë‹¹ê°€</div>
                        <div class="stat-card-value" th:text="${#numbers.formatInteger(marketAnalysis.averagePricePerPyeong, 0, 'COMMA')} + 'ë§Œ'">0ë§Œ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-label">ìµœê³  ê±°ë˜ê°€</div>
                        <div class="stat-card-value" th:text="${marketAnalysis.maxAmountFormatted}">0ì–µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-label">ê±°ë˜ ê±´ìˆ˜</div>
                        <div class="stat-card-value" th:text="${marketAnalysis.transactionCount} + 'ê±´'">0ê±´</div>
                    </div>
                </div>

                <!-- SEO ì£¼ë³€ì‹œì„¸ í…ìŠ¤íŠ¸ -->
                <p class="market-note-seo">
                    <th:block th:if="${dongName}"><span th:text="${dongName}">ì—­ì‚¼ë™</span> ì¼ëŒ€ </th:block>ìµœê·¼
                    3ê°œì›”ê°„ <span class="num" th:text="${marketAnalysis.transactionCount}">10</span>ê±´ì˜ ì•„íŒŒíŠ¸ ì‹¤ê±°ë˜ê°€ ìˆì—ˆê³ ,
                    í‰ê·  í‰ë‹¹ê°€ëŠ” <span class="num" th:text="${#numbers.formatInteger(marketAnalysis.averagePricePerPyeong, 0, 'COMMA')}">2,100</span>ë§Œì›,
                    ìµœê³  ê±°ë˜ê°€ëŠ” <span class="num" th:text="${marketAnalysis.maxAmountFormatted}">10ì–µ</span>ì´ì—ìš”.
                </p>
            </div>

            <div th:if="${marketAnalysis == null}" class="table-card">
                <div class="empty">ì£¼ë³€ ì‹¤ê±°ë˜ ë°ì´í„°ê°€ ì•„ì§ ì—†ì–´ìš”.</div>
            </div>
        </div>

        <!-- ========== ìµœê·¼ ê±°ë˜ ========== -->
        <div class="section" th:if="${recentTransactions != null and !recentTransactions.isEmpty()}">
            <h2 class="section-title">ìµœê·¼ ê±°ë˜ ë‚´ì—­</h2>
            <div class="table-card">
                <div class="tx-list">
                    <div th:each="tx : ${recentTransactions}" class="tx-item">
                        <div>
                            <div class="tx-name" th:text="${tx.aptName}">ì•„íŒŒíŠ¸ëª…</div>
                            <div class="tx-meta">
                                <span th:text="${tx.exclusiveArea} + 'ã¡'">84ã¡</span>
                                <span th:if="${tx.floor}"> Â· <span th:text="${tx.floor} + 'ì¸µ'">10ì¸µ</span></span>
                                <span th:if="${tx.dealDate}"> Â· <span th:text="${#temporals.format(tx.dealDate, 'yyyy.MM.dd')}">2025.01.01</span></span>
                            </div>
                        </div>
                        <div class="tx-price">
                            <span th:if="${tx.dealAmount >= 10000}"
                                  th:text="${#numbers.formatDecimal(tx.dealAmount / 10000.0, 1, 1)} + 'ì–µ'">10ì–µ</span>
                            <span th:if="${tx.dealAmount < 10000}"
                                  th:text="${#numbers.formatInteger(tx.dealAmount, 0, 'COMMA')} + 'ë§Œ'">5,000ë§Œ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-spacer"></div>
    </div>

    <footer th:replace="~{fragments/home-layout :: footer}"></footer>

    <!-- JSON-LD êµ¬ì¡°í™” ë°ì´í„° -->
    <script th:inline="javascript" type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Event",
        "name": /*[[${subscription.houseName + ' ì²­ì•½'}]]*/ "ì²­ì•½",
        "startDate": /*[[${subscription.receiptStartDate}]]*/ "",
        "endDate": /*[[${subscription.receiptEndDate}]]*/ "",
        "eventStatus": "https://schema.org/EventScheduled",
        "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
        "location": {
            "@type": "Place",
            "name": /*[[${subscription.area}]]*/ "",
            "address": /*[[${subscription.address}]]*/ ""
        },
        "organizer": {
            "@type": "Organization",
            "name": "Houseping",
            "url": "https://house-ping.com"
        }
    }
    </script>
    <script th:inline="javascript" type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "í™ˆ",
                "item": "https://house-ping.com/home"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": /*[[${subscription.houseName + ' ì²­ì•½ ë¶„ì„'}]]*/ "ì²­ì•½ ë¶„ì„",
                "item": /*[[${'https://house-ping.com/home/analysis/' + subscription.id}]]*/ ""
            }
        ]
    }
    </script>

    <script th:if="${kakaoMapAppKey != null and kakaoMapAppKey != ''}"
            th:src="'//dapi.kakao.com/v2/maps/sdk.js?appkey=' + ${kakaoMapAppKey} + '&amp;libraries=services'"></script>

    <script th:inline="javascript" th:if="${subscription.address != null and subscription.address != '' and kakaoMapAppKey != null and kakaoMapAppKey != ''}">
        window.addEventListener('load', function() {
            if (typeof kakao === 'undefined' || typeof kakao.maps === 'undefined') {
                document.getElementById('mapLoading').innerHTML = '<span>ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>';
                return;
            }

            const mapContainer = document.getElementById('kakaoMap');
            const mapLoading = document.getElementById('mapLoading');
            if (!mapContainer) return;

            const address = /*[[${subscription.address}]]*/ '';
            const houseName = /*[[${subscription.houseName}]]*/ '';

            const options = {
                center: new kakao.maps.LatLng(37.566826, 126.9786567),
                level: 3
            };

            const map = new kakao.maps.Map(mapContainer, options);
            const geocoder = new kakao.maps.services.Geocoder();

            searchAddress(address, false);

            function searchAddress(addr, isRetry) {
                geocoder.addressSearch(addr, function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        const coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                        mapLoading.style.display = 'none';
                        mapContainer.style.display = 'block';

                        setTimeout(function() {
                            map.relayout();
                            map.setCenter(coords);

                            const marker = new kakao.maps.Marker({
                                map: map,
                                position: coords
                            });
                            const infowindow = new kakao.maps.InfoWindow({
                                content: '<div style="width:150px;text-align:center;padding:6px 0;font-size:12px;">' + houseName + '</div>'
                            });
                            infowindow.open(map, marker);
                        }, 100);
                    } else if (!isRetry) {
                        const baseAddr = extractBaseAddress(addr);
                        if (baseAddr && baseAddr !== addr) {
                            searchAddress(baseAddr, true);
                        } else {
                            mapLoading.innerHTML = '<span>ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>';
                        }
                    } else {
                        mapLoading.innerHTML = '<span>ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>';
                    }
                });
            }

            function extractBaseAddress(address) {
                if (!address) return null;
                const words = address.trim().split(/\s+/);
                const suffixes = ['ë™', 'ë¦¬', 'ì', 'ë©´', 'ê°€', 'ë¡œ'];

                for (let i = 0; i < words.length; i++) {
                    const word = words[i];
                    for (const suffix of suffixes) {
                        if (word.endsWith(suffix) && word.length > 1) {
                            return words.slice(0, i + 1).join(' ');
                        }
                    }
                }
                return null;
            }
        });
    </script>
</body>
</html>
